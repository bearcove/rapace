# Enable experimental features
experimental = ["setup-scripts"]

[profile.default]
# Fail fast - stop on first failure
fail-fast = true

# Status level
status-level = "pass"

# Exclude coverage tests from default runs - they track spec compliance gaps
# Run them explicitly with: cargo nextest run -p rapace-conformance --test coverage
#
# Also exclude conformance tests for features not yet implemented in rapace-core:
# - cancel.cancel_idempotent: CancelChannel on non-existent channel should be ignored
# - cancel.cancel_impl_idempotent: Same as above
# - cancel.cancel_impl_support: CancelChannel support not fully implemented
# - channel.id_zero_reserved: Sending data on channel 0 should be rejected
# - channel.open_required_before_data: Data before OpenChannel should be rejected
# - control.ping_pong: Ping/Pong not implemented
# - control.unknown_extension_verb: Unknown extension verbs should be ignored
# - handshake.missing_hello: Meta-test that expects non-compliant behavior
default-filter = '''
    not (package(rapace-conformance) & test(/^rule\./))
    & not test(/^cancel\.cancel_idempotent$/)
    & not test(/^cancel\.cancel_impl_idempotent$/)
    & not test(/^cancel\.cancel_impl_support$/)
    & not test(/^channel\.id_zero_reserved$/)
    & not test(/^channel\.open_required_before_data$/)
    & not test(/^control\.ping_pong$/)
    & not test(/^control\.unknown_extension_verb$/)
    & not test(/^handshake\.missing_hello$/)
''' 

# Pre-build helper binaries before running tests
[scripts.setup.build-helpers]
command = "cargo build --bins -p rapace-diagnostics-over-rapace -p rapace-http-over-rapace -p rapace-template-engine -p rapace-tracing-over-rapace"
slow-timeout = { period = "60s" }

[profile.ci]
# CI profile with longer timeouts for cross-process tests
fail-fast = true
slow-timeout = { period = "30s", terminate-after = 2 }
status-level = "pass"

